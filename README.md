# å»ä¸­å¿ƒåŒ– NFT æ‹å–å¹³å°

ä¸€ä¸ªåŸºäºä»¥å¤ªåŠçš„å»ä¸­å¿ƒåŒ– NFT æ‹å–å¹³å°ï¼Œæ”¯æŒå¤šç§ä»£å¸æ”¯ä»˜ï¼Œé›†æˆ Chainlink ä»·æ ¼é¢„è¨€æœºï¼Œå¹¶é‡‡ç”¨å¯å‡çº§ä»£ç†æ¨¡å¼ã€‚

## ç›®å½•

- [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
- [æ ¸å¿ƒåŠŸèƒ½](#æ ¸å¿ƒåŠŸèƒ½)
- [æŠ€æœ¯æ¶æ„](#æŠ€æœ¯æ¶æ„)
- [åˆçº¦è¯´æ˜](#åˆçº¦è¯´æ˜)
- [ç¯å¢ƒè¦æ±‚](#ç¯å¢ƒè¦æ±‚)
- [å®‰è£…å’Œé…ç½®](#å®‰è£…å’Œé…ç½®)
- [éƒ¨ç½²æ­¥éª¤](#éƒ¨ç½²æ­¥éª¤)
- [åŠŸèƒ½è¯´æ˜](#åŠŸèƒ½è¯´æ˜)
- [æµ‹è¯•è¯´æ˜](#æµ‹è¯•è¯´æ˜)
- [åˆçº¦åœ°å€](#åˆçº¦åœ°å€)
- [è´¹ç”¨ç»“æ„](#è´¹ç”¨ç»“æ„)
- [å®‰å…¨è€ƒè™‘](#å®‰å…¨è€ƒè™‘)

## é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„å»ä¸­å¿ƒåŒ– NFT æ‹å–å¹³å°ï¼Œå…è®¸ç”¨æˆ·ï¼š
- åˆ›å»º NFT æ‹å–
- ä½¿ç”¨ ETH æˆ–æ”¯æŒçš„ ERC20 ä»£å¸è¿›è¡Œç«æ‹
- åŸºäºå®æ—¶æ±‡ç‡çš„ç¾å…ƒè®¡ä»·ç³»ç»Ÿ
- åŠ¨æ€æ‰‹ç»­è´¹ç»“æ„
- å¯å‡çº§çš„æ™ºèƒ½åˆçº¦æ¶æ„

## æ ¸å¿ƒåŠŸèƒ½

### æ‹å–å·¥å‚ (AuctionFactory)
- **æ‰¹é‡åˆ›å»ºæ‹å–**ï¼šé€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºæ ‡å‡†åŒ–çš„æ‹å–åˆçº¦
- **ä»£ç†æ¨¡å¼éƒ¨ç½²**ï¼šä½¿ç”¨ UUPS ä»£ç†å®ç°å¯å‡çº§æ€§
- **å®ç°åˆçº¦ç®¡ç†**ï¼šæ”¯æŒå‡çº§æ‹å–åˆçº¦å®ç°
- **æ‹å–è®°å½•**ï¼šç»´æŠ¤æ‰€æœ‰å·²åˆ›å»ºæ‹å–çš„ç´¢å¼•

### æ‹å–åˆçº¦ (Auction)
- **å¤šå¸ç§æ”¯ä»˜**ï¼šæ”¯æŒ ETH å’Œ USDC ç­‰ ERC20 ä»£å¸
- **å®æ—¶ä»·æ ¼è½¬æ¢**ï¼šé›†æˆ Chainlink ä»·æ ¼é¢„è¨€æœº
- **ç¾å…ƒè®¡ä»·**ï¼šæ‰€æœ‰å‡ºä»·ä»¥ç¾å…ƒä¸ºåŸºå‡†è¿›è¡Œæ¯”è¾ƒ
- **åŠ¨æ€æ‰‹ç»­è´¹**ï¼šæ ¹æ®æˆäº¤é‡‘é¢é‡‡ç”¨åˆ†å±‚è´¹ç‡
- **å®‰å…¨æœºåˆ¶**ï¼šé˜²é‡å…¥æ”»å‡»ã€æƒé™æ§åˆ¶ç­‰

### NFT åˆçº¦
- **æ ‡å‡† ERC721**ï¼šå®Œå…¨å…¼å®¹çš„ NFT å®ç°
- **æ‰¹é‡é“¸é€ **ï¼šæ”¯æŒä¸€æ¬¡æ€§é“¸é€ å¤šä¸ª NFT
- **å…ƒæ•°æ®å­˜å‚¨**ï¼šæ”¯æŒè‡ªå®šä¹‰ URI å’Œå…ƒæ•°æ®

## æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AuctionFactory â”‚    â”‚   Auction Proxy â”‚    â”‚ Chainlink Oracleâ”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ - Create Auctionâ”‚â”€â”€â”€â”€â–¶â”‚ - Bid with ETH  â”‚â”€â”€â”€â”€â–¶â”‚ - ETH/USD Feed  â”‚
â”‚ - Track Auctionsâ”‚    â”‚ - Bid with Tokenâ”‚    â”‚ - USDC/USD Feed â”‚
â”‚ - Upgrade Logic â”‚    â”‚ - End Auction   â”‚    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
         â”‚                       â–¼
         â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚              â”‚      NFT        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                 â”‚
                        â”‚ - ERC721        â”‚
                        â”‚ - Batch Mint    â”‚
                        â”‚ - URI Storage   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åˆçº¦è¯´æ˜

### AuctionFactory.sol
æ‹å–å·¥å‚åˆçº¦ï¼Œè´Ÿè´£åˆ›å»ºå’Œç®¡ç†æ‹å–å®ä¾‹ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- `createAuction()` - åˆ›å»ºæ–°çš„æ‹å–
- `getAuctions()` - è·å–æ‰€æœ‰æ‹å–åˆ—è¡¨
- `upgradeImplementation()` - å‡çº§æ‹å–åˆçº¦å®ç°

### Auction.sol / AuctionV2.sol
æ‹å–é€»è¾‘åˆçº¦ï¼Œé‡‡ç”¨å¯å‡çº§ä»£ç†æ¨¡å¼ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- `bidWithETH()` - ä½¿ç”¨ ETH ç«æ‹
- `bidWithToken()` - ä½¿ç”¨ ERC20 ä»£å¸ç«æ‹
- `endAuction()` - ç»“æŸæ‹å–
- `claimNFT()` - è·èƒœè€…é¢†å– NFT
- `claimPayment()` - å–å®¶é¢†å–ä»˜æ¬¾

### NFT.sol
æ ‡å‡†çš„ ERC721 NFT åˆçº¦ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- `mint()` - é“¸é€ å•ä¸ª NFT
- `batchMint()` - æ‰¹é‡é“¸é€  NFT

## ğŸ”§ ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- npm æˆ– yarn
- Git

## å®‰è£…å’Œé…ç½®

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/miffyG/solidity_learn_task3.git
cd solidity_learn_task3
```

### 2. å®‰è£…ä¾èµ–
```bash
npm install
```

### 3. ç¯å¢ƒé…ç½®
åˆ›å»º `.env` æ–‡ä»¶å¹¶é…ç½®ä»¥ä¸‹å˜é‡ï¼š

```env
# ç½‘ç»œé…ç½®
SEPOLIA_RPC_URL=YOUR_SEPOLIA_RPC_URL
PRIVATE_KEY=your_private_key_here

# API Keys
ETHERSCAN_API_KEY=your_etherscan_api_key

# å¯é€‰
REPORT_GAS=true
```

**å®‰å…¨æé†’ï¼š**
- ä¸è¦å°†ç§é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ä½¿ç”¨æµ‹è¯•ç½‘ç»œè¿›è¡Œå¼€å‘å’Œæµ‹è¯•
- ç¡®ä¿ç§é’¥å¯¹åº”çš„è´¦æˆ·æœ‰è¶³å¤Ÿçš„æµ‹è¯• ETH

## éƒ¨ç½²æ­¥éª¤

### 1. ç¼–è¯‘åˆçº¦
```bash
npm run compile
```

### 2. è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test

# è¿è¡Œç‰¹å®šæµ‹è¯•
npm run test:factory
npm run test:auction
npm run test:nft
```

### 3. éƒ¨ç½²åˆ° Sepolia æµ‹è¯•ç½‘
```bash
npm run deploy
```

éƒ¨ç½²å®Œæˆåï¼Œä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆ `deployment.json` æ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰åˆçº¦åœ°å€ã€‚

### 4. å‡çº§æ‹å–åˆçº¦ï¼ˆå¯é€‰ï¼‰
å¦‚æœéœ€è¦å‡çº§æ‹å–åˆçº¦å®ç°ï¼š
```bash
npm run upgrade
```

## åŠŸèƒ½è¯´æ˜

### åˆ›å»º NFT æ‹å–

è°ƒç”¨ `createAuction()` å‡½æ•°åˆ›å»ºæ–°çš„æ‹å–ã€‚æ³¨æ„ï¼šè°ƒç”¨å‰éœ€è¦ç¡®ä¿ AuctionFactory åˆçº¦å·²è·å¾—è½¬ç§»è¯¥ NFT çš„æˆæƒã€‚

```solidity
// åˆ›å»ºæ‹å–
auctionFactory.createAuction(
    seller,           // å–å®¶åœ°å€
    nftAddress,       // NFT åˆçº¦åœ°å€
    tokenId,          // NFT Token ID
    startingPriceUSD, // èµ·å§‹ä»·æ ¼ï¼ˆç¾å…ƒï¼Œ18ä½å°æ•°ï¼‰
    duration,         // æ‹å–æ—¶é•¿ï¼ˆç§’ï¼‰
    ethPriceFeed      // ETH ä»·æ ¼é¢„è¨€æœºåœ°å€
);
```

**å·¥ä½œæµç¨‹ï¼š**
1. AuctionFactory é¦–å…ˆå°† NFT ä»å–å®¶è½¬ç§»åˆ°è‡ªå·±
2. åˆ›å»ºæ‹å–ä»£ç†åˆçº¦å¹¶åˆå§‹åŒ–
3. å°† NFT è½¬ç§»åˆ°æ–°åˆ›å»ºçš„æ‹å–åˆçº¦

### å‚ä¸ç«æ‹

#### ä½¿ç”¨ ETH ç«æ‹
```solidity
// ç›´æ¥å‘é€ ETH
auction.bidWithETH{value: bidAmount}();

// æˆ–è€…å‘é€ ETH åˆ°åˆçº¦åœ°å€ï¼ˆä¼šè‡ªåŠ¨è°ƒç”¨ bidWithETHï¼‰
```

#### ä½¿ç”¨ ERC20 ä»£å¸ç«æ‹
```solidity
// 1. æˆæƒä»£å¸è½¬ç§»
token.approve(auctionAddress, bidAmount);

// 2. è¿›è¡Œç«æ‹
auction.bidWithToken(tokenAddress, bidAmount);
```

### ç»“æŸæ‹å–å’Œé¢†å–

```solidity
// 1. ç»“æŸæ‹å–
auction.endAuction();

// 2. è·èƒœè€…é¢†å– NFT
auction.claimNFT();

// 3. å–å®¶é¢†å–ä»˜æ¬¾
auction.claimPayment();
```

## æµ‹è¯•è¯´æ˜

é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼š

### è¿è¡Œæµ‹è¯•
```bash
# æ‰€æœ‰æµ‹è¯•
npm test

# å·¥å‚åˆçº¦æµ‹è¯•
npm run test:factory

# æ‹å–åˆçº¦æµ‹è¯•  
npm run test:auction

# NFT åˆçº¦æµ‹è¯•
npm run test:nft

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run coverage
```

### æµ‹è¯•è¦†ç›–èŒƒå›´
- âœ… åˆçº¦éƒ¨ç½²å’Œåˆå§‹åŒ–
- âœ… æ‹å–åˆ›å»ºå’Œç®¡ç†
- âœ… å¤šå¸ç§ç«æ‹é€»è¾‘
- âœ… ä»·æ ¼é¢„è¨€æœºé›†æˆ
- âœ… è´¹ç”¨è®¡ç®—
- âœ… æƒé™æ§åˆ¶
- âœ… å¼‚å¸¸å¤„ç†
- âœ… åˆçº¦å‡çº§

## åˆçº¦åœ°å€

éƒ¨ç½²å®Œæˆåçš„åˆçº¦åœ°å€å°†ä¿å­˜åœ¨ `deployment.json` æ–‡ä»¶ä¸­ï¼š

```json
{
  "network": "sepolia",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "deployer": "0x...",
  "contracts": {
    "auctionFactory": "0x...",
    "auctionImplementation": "0x...",
    "implementationVersion": "1"
  }
}
```

### Sepolia æµ‹è¯•ç½‘é¢„è¨€æœºåœ°å€
- **ETH/USD**: `0x694AA1769357215DE4FAC081bf1f309aDC325306`
- **USDC/USD**: `0xA2F78ab2355fe2f984D808B5CeE7FD0A93D5270E`

## è´¹ç”¨ç»“æ„

æœ¬å¹³å°é‡‡ç”¨åŠ¨æ€æ‰‹ç»­è´¹æœºåˆ¶ï¼Œæ ¹æ®æˆäº¤é‡‘é¢åˆ†å±‚æ”¶è´¹ï¼š

| æˆäº¤é‡‘é¢ï¼ˆUSDï¼‰ | æ‰‹ç»­è´¹ç‡ | ç¤ºä¾‹ |
|----------------|----------|------|
| < $1,000       | 2.5%     | $100 æˆäº¤ â†’ $2.5 æ‰‹ç»­è´¹ |
| $1,000 - $9,999| 2.0%     | $5,000 æˆäº¤ â†’ $100 æ‰‹ç»­è´¹ |
| $10,000 - $99,999| 1.5%   | $50,000 æˆäº¤ â†’ $750 æ‰‹ç»­è´¹ |
| â‰¥ $100,000     | 1.0%     | $200,000 æˆäº¤ â†’ $2,000 æ‰‹ç»­è´¹ |

## å®‰å…¨è€ƒè™‘

### å·²å®ç°çš„å®‰å…¨æªæ–½
- âœ… **é‡å…¥æ”»å‡»é˜²æŠ¤**ï¼šä½¿ç”¨ ReentrancyGuard
- âœ… **æƒé™æ§åˆ¶**ï¼šåŸºäº OpenZeppelin Ownable
- âœ… **å®‰å…¨çš„ä»£å¸è½¬ç§»**ï¼šä½¿ç”¨ SafeERC20
- âœ… **è¾“å…¥éªŒè¯**ï¼šå…¨é¢çš„å‚æ•°æ£€æŸ¥
- âœ… **æ—¶é—´é”å®š**ï¼šæ‹å–æ—¶é—´æ§åˆ¶
- âœ… **ä»·æ ¼éªŒè¯**ï¼šé¢„è¨€æœºæ•°æ®éªŒè¯

## å¼€å‘å·¥å…·

- **Hardhat**ï¼šå¼€å‘ç¯å¢ƒå’Œæµ‹è¯•æ¡†æ¶
- **OpenZeppelin**ï¼šå®‰å…¨çš„æ™ºèƒ½åˆçº¦åº“
- **Chainlink**ï¼šå»ä¸­å¿ƒåŒ–é¢„è¨€æœºç½‘ç»œ
- **Ethers.js**ï¼šä»¥å¤ªåŠäº¤äº’åº“

**âš ï¸ å…è´£å£°æ˜ï¼šæœ¬é¡¹ç›®ä»…ç”¨äºå­¦ä¹ å’Œç ”ç©¶ç›®çš„ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å‰ï¼Œè¯·è¿›è¡Œå……åˆ†çš„æµ‹è¯•å’Œå®‰å…¨å®¡è®¡ã€‚**
